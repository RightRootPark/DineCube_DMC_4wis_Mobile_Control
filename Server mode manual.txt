8.6.2. Server Mode 
⚫ TCPSStart socket 변수, port number 
▪ socket 변수가 음수가 반환되면, 에러가 발생한 경우입니다. 
⚫ TCPSStop socket 변수 
▪ socket이 close 됩니다. 
⚫ TCPSAccept socket 변수, client_socket 변수 
▪ Client_socket 변수가 음수가 반환되면, 에러가 발생한 경우입니다. 
⚫ TCPSCClose client_socket 변수 
▪ Client_socket이 close 됩니다. 
⚫ TCPSRead client_socket 변수, 문자 변수, [에러코드변수], timeout 
▪ 연결된 client로부터 읽기를 대기합니다. 
⚫ TCPSWrite client_socket 변수, 문자열, [에러코드변수] 
▪ 연결된 client로 문자열을 전송합니다. 
서버모드의 예제는 비전 인터페이스 프로그램 예제를 살펴보기 바랍니다. 통신
으로 전달받은 문자열은 숫자 데이터로 변환할 필요가 있는데, 이 때 사용하는 
함수가, 문자열을 토큰으로 분리하는 SplitStr 명령어와, 문자열을 숫자로 바꾸어 
주는 함수 Value를 사용합니다.  
 - 52 -CL Programming Manual 

<SplitStr 명령어 사용 예> 
“%-2.1,15.4,95”에서 tx = -2.1, ty = 15.4, trot = 95를 얻어 내는 방법 
$msgread = “%-2.1,15.4,95” 
SplitStr $token[0], $msgread, “%,” 
;$msgread에서 ‘%’, ‘,’ 두 글자를 분리 글자로 사용하게 합니다.  
; 
$token[0] = “-2.1”, $token[1] = “15.4”, $token[2] = “95”가 들어
가게 됩니다. 
Tx = Value($token[0]) 
Ty = Value($token[1]) 
Trot = Value($token[2])

 
 <컨베이어 동기화 프로그램 예제: 모션이 가능한 Motion Task> 
; move home position 
dist = 70  ; approach distance 
convid = 1  ; conveyor id 
Accuracy 50 Fixed ;  
Point phome = Trans(20,0,680) 
Point pdrop = Trans(190,0,675) 
Point ppick = Trans(0) ; object coordinate 점으로 좌표계의 원점 
MoveL phome  ; 대기 위치 이동 
TkObjWait convid  ; object 대기 
; catch target - ppick is relative w.r.t the conveyor reference 
TkMove convid,ppick 
TkAppro convid,dist  ; ppick에서 ToolZ방향으로 dist만큼 이동 
Signal 1,2   ;  
TkDepart convid,dist  ;  
Break   ; 현재는 Track 모션 종료 시 반드시 삽입 
MoveL pdrop  ; object drop 
Signal -1,-2 
 
⚫ TkAppro/TkDepart 대신에 아래처럼 해도 됩니다. 
▪ Point ppick2 = Translate(ppick, 0, 0, 70) 
▪ TkMove cnvid, ppick2 
▪ TkMove cnvid, ppick 
⚫ 이 프로그램만 동작시키면, Trigger 시그널이 작동될 때마다, 기준 Target위치로 이
동하게 됩니다. 변경이 필요할 경우엔 다음 예제인 비전 인터페이스를 적용합니다. 
⚫ 중간에 프로그램을 멈추고 다시 시작할 때는 Reset을 수행하여 처음부터 프로그램
을 다시 실행하는 것이 안전합니다. 
  CL Programming Manual - 56 - 
 
 


<비전인터페이스 프로그램 예제: Process Task에서 동시 실행> 

cognex = 0 
server = 0 
count = 0 
vis_ret = 0 
; open new socket 
TCPSStart server,3240 
TCPSAccept server,cognex 
WHILE TRUE DO 
$msgread = "" 
TCPSRead cognex,$msgread,vis_ret 
IF vis_ret == 0 THEN 
TPWrite 2,"Vision disconnected",0 
GOTO 100 
END 
SplitStr $token[0],$msgread,"%, "   ;  형식 dx, dy 만 전달: “%8.3,-2.5” 
; apply transform 
tx = Value($token[0]) 
ty = Value($token[1]) 
TkObjShift 1,tx,ty,0 
END ; end of while 
100     TCPSStop server 
 
⚫ Trigger signal에 의해 비전이 하나의 Object에 대해, 평행 이동량만 인식할 경우의 
예입니다. 다수의 object를 전송 시 Filter, Clone등의 기능을 사용해야 합니다. 
⚫ 중간에 멈출 경우, TCP 연결 문제로 Reset 후 다시 실행하여야 합니다. 
⚫ 비전과의 통신만 테스트할 경우, 아래의 TPWrite 명령으로 주고받는 데이터를 확인
할 수 있습니다. 
▪ TCPSRead cognex, $msgread, vis_ret 
▪ TPWrite 2, “Vision: %s”, $msgread 
⚫ 고속으로 사용할 경우, 위와 같은 Diagnostic message로 인한 시간 초과로 사용을 
하지 않는 것이 좋습니다. 

8.8. 기타 
 
⚫ ULIMIT / LLIMIT 각축 값: upper limit, lower limit 설정 
▪ ULimit Joint(170,90,100,140,150,360) 
▪ LLimit Joint(-170,-90,-100,-140,-150,-360) 